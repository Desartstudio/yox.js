/*
* yox.js
* HTML5 gallery library
* http://www.yoxjs.com
*
* Copyright (c) 2012 Yossi Kolesnicov
*
* License: MIT license
* Date: 2012-06-13 
*/
function Yox(a,b){this.container=a,this.options=b||{},this.init()}Function.prototype.bind||(Function.prototype.bind=function(a){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d?this:a||window,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),!("classList"in document.documentElement)&&Object.defineProperty&&typeof HTMLElement!="undefined"&&Object.defineProperty(HTMLElement.prototype,"classList",{get:function(){function b(b){return function(c){var d=a.className.split(/\s+/),e=d.indexOf(c);b(d,e,c),a.className=d.join(" ")}}var a=this,c={add:b(function(a,b,c){~b||a.push(c)}),remove:b(function(a,b){~b&&a.splice(b,1)}),toggle:b(function(a,b,c){~b?a.splice(b,1):a.push(c)}),contains:function(b){return!!~a.className.split(/\s+/).indexOf(b)},item:function(b){return a.className.split(/\s+/)[b]||null}};return Object.defineProperty(c,"length",{get:function(){return a.className.split(/\s+/).length}}),c}}),Yox.prototype={init:function(){if(this.options.theme){var a=new yox.eventsHandler,b,c=this;this.options.data&&(this.options.data instanceof yox.data?b=this.options.data:b=new yox.data(this.options.data));function d(d,e){var f=yox.themes[d];if(!f)throw new Error("Invalid theme, '"+d+"' does not exist.");var g=new f(b,$.extend({},f.defaults,e));if(g instanceof yox.theme)return g.init(c.container,b,a,e),g;throw new Error("Invalid theme, '"+d+"' is not an instance of yox.theme.")}if(this.options.theme instanceof Array){this.themes={};for(var e=0,f;f=this.options.theme[e];e++)this.themes[f.id||f.name]=d(f.name,f.options||{})}else{var f=d(this.options.theme,this.options);this.modules=f.modules}$.extend(this,{destroy:function(){for(var a in this.modules){var b=this.modules[a],c=b.destroy;c&&c.call(b)}f.destroy.call(f)},data:b},a);if(this.options.events)for(var g in this.options.events)this.addEventListener(g,this.options.events[g])}delete this.init}},yox=typeof yox=="undefined"?{}:yox,$.fn.yox=function(a){return this.length?this.each(function(b,c){var d=$(this).data("yox");if(typeof a=="string"&&d)if(d&&d[a])d[a].apply(d,Array.prototype.slice.call(arguments,1));else throw new Error("Invalid method '"+a+"'");else Object(a)===a||!a?$(this).data("yox",new Yox(this,a)):$.error("Method "+a+" does not exist on Yox.")}):this},yox.utils={browser:{getCssPrefix:function(){if(arguments.callee.cache)return arguments.callee.cache;var a="-"+yox.utils.browser.getPrefix().toLowerCase()+"-";return this.cache=a,a},getPlatform:function a(){if(arguments.callee.platform)return arguments.callee.platform;var a=/(Android)|(iPhone)|(iPod)/;return arguments.callee.platform=a.test(navigator.userAgent)||screen.width*screen.height<4e5?this.platforms.mobile:this.platforms.desktop,arguments.callee.platform},getPrefix:function(){if(arguments.callee.cache)return arguments.callee.cache;var a=["Moz","Webkit","O","ms"],b=document.createElement("div"),c="Transform",d,e,f;for(var g=0;g<a.length&&!f;g++)e=a[g],d=e+c,d in b.style&&(f=e);return arguments.callee.cache=f,f},platforms:{desktop:"desktop",mobile:"mobile"}},css:{addJqueryCssHook:function(a){if(typeof jQuery=="undefined")return!1;var b=yox.utils.css.getSupportedProperty(a);return b&&b!==a&&(jQuery.cssHooks[a]={get:function(a,c,d){return $.css(a,b)},set:function(a,c){a.style[b]=c}}),!0},addJqueryCssHooks:function(a){for(var b=a.length;b--;)yox.utils.css.addJqueryCssHook(a[b])},getSupportedProperty:function(a){var b,c,d=a.charAt(0).toUpperCase()+a.slice(1),e=yox.utils.browser.getPrefix(),f=document.createElement("div");return a in f.style?c=a:(b=e+d,b in f.style&&(c=b)),f=null,$.support[a]=c,c}},dom:{isElement:Object(HTMLElement)===HTMLElement?function(a){return a instanceof HTMLElement}:Object(Element)===Element?function(a){return a instanceof Element}:function(a){return Object(el)===el&&el.nodeType===1&&typeof el.nodeName=="string"},scrollIntoView:function(a,b,c,d){function o(a){var b=i[a]-k[a]-d;if(l[a]>b)m[a]=k[a]+b;else{var c=n[a],e=i[a]-k[a]+j[c]+d,g=l[a]+f[c];g<e&&(m[a]=k[a]+e-g)}}var e=b;b===document.body&&!$.browser.webkit&&(e=document.documentElement);var f={width:b.clientWidth,height:b.clientHeight},g={height:e.scrollHeight,width:e.scrollWidth};d=d||0;if(f.height>=g.height&&f.width>=g.width)return!1;if(!c)return a.scrollIntoView(),!0;var h=$(a),i=h.offset(),j={width:h.width(),height:h.height()},k={left:e.scrollLeft,top:e.scrollTop},l=$(b).offset(),m={},n={top:"height",left:"width"};o("top"),o("left");if(m.top!==undefined||m.left!==undefined){var p={};m.top&&(p.scrollTop=m.top),m.left&&(p.scrollLeft=m.left),$(e).stop(!0,!0).animate(p,c)}}},dimensions:{distributeMeasures:function(a){var b={top:0,bottom:0,left:0,right:0};if(a){var c=typeof a=="number";for(var d in b)b[d]=c?a:a[d]||0}return b.horizontal=b.left+b.right,b.vertical=b.top+b.bottom,b},resize:{fill:function(a,b,c){c=c||{},a.ratio=a.ratio||a.height/a.width;var d=c.enlarge?b.width:Math.min(a.width,b.width),e=Math.round(d*a.ratio),f=b.height;return e<f&&(f<=a.height||c.enlarge)&&(e=f,d=Math.round(e/a.ratio)),{left:Math.round((b.width-d)/2),top:Math.round((b.height-e)/2),width:Math.round(d),height:Math.round(e)}},fit:function(a,b,c){c=c||{},a.ratio=a.ratio||a.height/a.width;var d=c.margin||{},e=c.padding||{},f=b.width-(d.horizontal||0)-(e.horizontal||0),g=c.enlarge?f:Math.min(a.width,f),h=Math.round(g*a.ratio),i=b.height-(d.vertical||0)-(e.vertical||0);return h>i&&(h=i,g=Math.round(h/a.ratio)),{left:(b.width-(d.left||0)-(d.right||0)-g)/2+(d.left||0)-(e.left||0),top:(b.height-(d.top||0)-(d.bottom||0)-h)/2+(d.top||0)-(e.top||0),width:g,height:h}}}},performance:{debounce:function(a,b,c){var d=this,e=Array.prototype.slice.call(arguments,2);clearTimeout(a.bounceTimer),a.bounceTimer=setTimeout(function(){a.apply(d,e)},b)},throttle:function(a,b){return a.bounceTimer=null,function(){var c=this,d=arguments;clearTimeout(a.bounceTimer),a.bounceTimer=setTimeout(function(){a.apply(c,d)},b)}}},url:{queryToJson:function(a){if(!a)return null;var b=a.split("&"),c={};for(var d=b.length;d--;){var e=b[d].split("=");c[e[0]]=e.length==2?e[1]:!0}return c}}},yox.eventsHandler=function(){var a={_default:{}},b,c,d=this;this.triggerEvent=function(e,f,g){b=e;var h=e.split("."),i=h[0],j=h[1];if(j){var k=a[j];if(k){var l=k[i];if(l)for(var m=0,n;n=l[m];m++)n.call(this,f,g)}}var o=a._default[i];if(o)for(var m=0,n;n=o[m];m++)n.call(this,f,g);b=undefined;if(c){for(var m=0,p;p=c[m];m++)d.removeEventListener(p.eventName,p.eventHandler);c=undefined}},this.addEventListener=function(b,c){var d=b.split("."),e=d[0],f=d[1],g;f?(g=a[f],g||(g=a[f]={})):g=a._default;var h=g[e];h||(h=g[e]=[]),h.push(c)},this.removeEventListener=function(d,e){if(d===b)return c=c||[],c.push({eventName:d,eventHandler:e}),!1;var f=d.split("."),g=f[0],h=f[1],i,j=!1;h?(i=a[h],i||(i=a[h]={})):i=a._default;var k=i[g];if(k&&k.length)for(var l=k.length;l--;)k[l]===e&&(k.splice(l,1),j=!0);return j}},yox.eventsHandler.prototype={bindTriggerEvent:function(a,b){var c=this;return function(d,e){return c.triggerEvent.call(a,d,e,b)}}},yox.data=function(a){this.data=[],this.options=$.extend(!0,{},this.defaults,a);var b=this.options.eventsHandler||new yox.eventsHandler;$.extend(this,b);if(this.options.events)for(var c in this.options.events)this.addEventListener(c,this.options.events[c]);this.options.source&&this.addSources(this.options.source)},yox.data.prototype={defaults:{cache:!1},addSources:function(a){var b=[],c=a instanceof Array?a:arguments,d=this;this.triggerEvent("loadSourcesStart",c),this.isLoading=!0;for(var e=0,f;f=c[e];e++){var g=this.loadSource(f);g&&b.push(g)}$.when.apply(this,b).done(function(){var a=d.countItems();for(var b=0,c;b<arguments.length;b++){c=arguments[b],c.id=d.data.length,c.parent=d;for(var e=0,f;f=c.items[e];e++)f.id=++a,f.indexInSource=e,f.source=c,c.items[e]=new yox.data.item(f);d.data.push(c)}d.isLoading=!1,d.triggerEvent("loadSources",Array.prototype.slice.call(arguments,0))})},clear:function(){this.triggerEvent("removeSources",this.data),this.triggerEvent("clear"),this.data=[]},countItems:function(){var a=0;for(var b=this.data.length;b--;)a+=this.data[b].items.length;return a},findDataSource:function(a){for(var b in yox.data.sources){var c=yox.data.sources[b];if(c.match(a))return c}return null},getData:function(){return this.data},getDataSource:function(a){return yox.data.sources[a]},loadSource:function(a){var b=a.type?this.getDataSource(a.type):this.findDataSource(a),c=this;if(!b)return null;var d=$.Deferred(),e=function(b){c.store(a,b),d.resolve(b)},f=this.store(a);if(f)e(f);else{a.page&&a.pageSize&&a.offset===undefined&&(a.offset=a.pageSize*a.page);if(b.map)for(var g in b.map){var h=a[g];h&&(a[b.map[g]]=h)}b.load(a,e,function(a){d.reject()})}return d},source:function(a){this.clear(),this.addSources.apply(this,arguments)},store:function(a,b){if(!this.options.cache||!window.localStorage||!a||!a.url)return!1;var c=this.namespace+".source."+a.url;if(!b){var d=window.localStorage.getItem(c);return d?JSON.parse(d):null}return window.localStorage.setItem(c,JSON.stringify(b)),!0}},yox.data.item=function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},yox.data.item.prototype={get next(){if(this.indexInSource<this.source.items.length-1)return this.source.items[this.indexInSource+1];if(this.source.id<this.source.parent.data.length-1){var a=this.source.parent.data[this.source.id+1].items;return a[0]||null}return null},get previous(){if(this.indexInSource)return this.source.items[this.indexInSource-1];if(this.source.id){var a=this.source.parent.data[this.source.id-1].items;return a[a.length-1]}return null}},yox.data.source=function(){},yox.data.sources={},yox.data.source.prototype={load:function(a,b){throw new Error("'load' function isn't implemented for this data source.")},match:function(a){throw new Error("'match' function isn't implemented for this data source.")}},yox.data.sources.picasa=function(){function h(a,b){var d=a.match(c),h=$.extend({},g,b);if(d&&d.length>1){var j={user:d[1],album:d[2],query:d[3]};h.user=j.user,j.album?(h.album=j.album,h.fields+=",entry(summary),gphoto:name"):h.fields+=",entry(title),entry(gphoto:numphotos),entry(gphoto:name),entry(link[@rel='alternate']),author,entry(summary),entry(id)",j.query&&$.extend(h,yox.utils.url.queryToJson(j.query))}return h.imgmax=i(f,h.imgmax),h.thumbsize=i(h.cropThumbnails?e:f,h.thumbsize)+(h.cropThumbnails?"c":"u"),h}function i(a,b){var c=Math.min(b,Math.max(screen.width,screen.height));for(var d=a.length,e;d-- -1&&(e=a[d])&&a[d-1]>=c;);return e}function j(a){var b=d;return a.user&&a.user!="lh"?(b+="user/"+a.user,a.album&&(b+="/album/"+a.album)):b+="all",b}function k(a,b){var c=a.feed.entry,d=[];return jQuery.each(a.feed.entry,function(a,b){var c=b.category[0].term.match(/#(.*)$/)[1]==="album";if(c&&!b.gphoto$numphotos.$t)return!0;var e=c?b.title.$t:b.summary.$t,f=b.media$group.media$content[0],g={thumbnail:{src:b.media$group.media$thumbnail[0].url},url:f.url,link:b.link[0].href,title:e,type:"image",author:{name:b.media$group.media$credit[0].$t},width:parseInt(b.gphoto$width,10),height:parseInt(b.gphoto$height,10)};g.ratio=g.height/g.width,c?(g.data={album:{name:b.gphoto$name.$t,imageCount:b.gphoto$numphotos.$t,description:b.summary.$t}},g.isLoaded=!0):$.extend(g,{width:f.width,height:f.height,ratio:f.height/f.width}),d.push(g)}),d}var a="picasa",b=/^https?:\/\/picasaweb\.google\./,c=/^https?:\/\/picasaweb\.google\.\w+\/([^\/#\?]+)\/?([^\/#\?]+)?(?:\?([^#]*))?/,d="http://picasaweb.google.com/data/feed/api/",e=[32,48,64,72,104,144,150,160],f=[94,110,128,200,220,288,320,400,512,576,640,720,800,912,1024,1152,1280,1440,1600].concat(e).sort(function(a,b){return a-b}),g={setThumbnail:!0,setSingleAlbumThumbnails:!0,setTitle:!0,alt:"json",cropThumbnails:!1,thumbsize:64,imgmax:f[f.length-1],fields:"category(@term),entry(category(@term)),title,entry(summary),entry(media:group(media:thumbnail(@url))),entry(media:group(media:content(@url))),entry(media:group(media:content(@width))),entry(media:group(media:content(@height))),entry(link[@rel='alternate'](@href)),entry(media:group(media:credit)),openSearch:totalResults,entry(gphoto:height),entry(gphoto:width)"};return{name:a,map:{pageSize:"max-results",offset:"start-index"},match:function(a){return a.url&&b.test(a.url)},load:function(b,c){var d=h(b.url,b);$.ajax({url:j(d),dataType:"jsonp",data:d,success:function(d){var e={source:b,sourceType:a,totalItems:d.feed.openSearch$totalResults.$t};if(!d.feed.entry||d.feed.entry.length==0)e.items=[];else{var f=d.feed.category[0].term.match(/#(.*)$/)[1];f==="user"&&$.extend(e,{title:d.feed.title.$t,data:{kind:"user",author:{name:d.feed.author[0].name.$t,link:d.feed.author[0].uri.$t}}}),e.createThumbnails=!0,e.items=k(d,f)}c&&c(e)},error:function(a,b){console.log("error: ",arguments)}})}}}(),yox.statistics=function(a,b){arguments.length===1&&(b=a,a=null),this.reporter=new yox.statistics.reporters[b.reporter||yox.statistics.defaults.reporter](b),this.category=b.category||"yox.js";var c=b.eventsHandler||new yox.eventsHandler;$.extend(this,c);if(b.events)for(var d in b.events)this.addEventListener(d,b.events[d])},yox.statistics.prototype={report:function(a){a.category=a.category||this.category,this.reporter.report(a)}},yox.statistics.defaults={reporter:"ga"},yox.statistics.reporter=function(a){this.name=a},yox.statistics.reporters={},yox.statistics.reporter.prototype={report:function(a){throw new Error("'report' method isn't implemented yet for this reporter type.")}},yox.statistics.reporters.ga=function(a){if(!_gaq)throw new Error("Can't initialize Google Analytics reporter, Google Analytics isn't loaded.");this.report=function(b){_gaq.push(["_trackEvent",b.category||a.category,b.action,b.label,b.value])}},yox.statistics.reporters.ga.prototype=new yox.statistics.reporter("ga"),function(a,b){yox.thumbnails=function(b,c){var d=this;this.container=b instanceof jQuery?b[0]:b,this.options=a.extend(!0,{},this.defaults,c),this.itemCount=0;var e=this.options.eventsHandler||new yox.eventsHandler;a.extend(this,e),this.triggerEvent=function(a,b){e.triggerEvent.call(d,a,b,d)};if(this.options.events)for(var f in this.options.events)this.addEventListener(f,this.options.events[f]);this.options.data&&this.addDataSources(this.options.data);if(this.options.handleClick!==!1){function g(b){var c=this.getAttribute("data-yoxthumbIndex"),e;b.preventDefault(),this.classList&&d.options.selectedThumbnailClass?e=this.classList.contains(d.options.selectedThumbnailClass):e=a(this).hasClass(d.options.selectedThumbnailClass),d.triggerEvent("click",{originalEvent:b,index:c,target:this,isSelected:e}),e||d.select(c)}a(this.container).on("click","[data-yoxthumbindex]",g),this.addEventListener("beforeDestroy",function(){a(this.container).off("click","."+d.options.thumbnailClass,g)})}},yox.thumbnails.prototype={addDataSources:function(a){function c(a){for(var c=0;c<a.length;c++){var d=a[c];b.createThumbnails(d)}}function e(a){b.options.allowAppend||(b.clear(),this.itemCount=0),c(a)}var b=this,d=a.getData();d&&d.length&&c(d),a.addEventListener("loadSources",e),this.addEventListener("beforeDestroy",function(){a.removeEventListener("loadSources",e)}),a.addEventListener("clear",function(){b.clear(),this.itemCount=0})},clear:function(){this.thumbnails&&this.thumbnails.remove(),this.itemCount=0,this.currentSelectedThumbnail=null,this.thumbnails=a()},createThumbnail:function(c){var d=this,e=a("<a>",{href:c.link||c.url,title:this.options.renderThumbnailsTitle!==!1?c.title:b,"class":d.options.thumbnailClass});return e.append(a("<img>",{src:this.options.useFullImages?c.url:c.thumbnail.src,alt:c.title})),e[0]},createThumbnails:function(b){var c=this,d;this.thumbnails=this.thumbnails||a();if(b.createThumbnails!==!1){if(a.tmpl){var e=a.tmpl(a.template(this.template),b.items,{options:this.options,getIndex:function(){return c.itemCount++}});e.appendTo(this.container),this.thumbnails=e}else{var f=document.createDocumentFragment();for(var g=0,h=b.items.length;g<h;g++,this.itemCount++){var i=b.items[g],j=c.options.createThumbnail?c.options.createThumbnail.call(c,g,i,h):this.createThumbnail(i);j.setAttribute("data-yoxthumbindex",this.itemCount),i.thumbnail.element=j,i.thumbnail.generated=!0;var k=j.getElementsByTagName("img");k.length&&(i.thumbnail.image=k[0]),f.appendChild(j)}this.thumbnails=this.thumbnails.add(f.childNodes),this.container.appendChild(f)}d=this.container.childNodes}else{var l=a("a:has(img)",this.container).attr("data-yoxthumbindex",function(a){return c.itemCount++});this.thumbnails=this.thumbnails.add(l),d=l.get()}this.triggerEvent("create",{thumbnails:d,items:b.items})},defaults:{allowAppend:!0,renderThumbnailsTitle:!0,selectedThumbnailClass:"selectedThumbnail",thumbnailClass:"yoxthumbnail"},destroy:function(){this.triggerEvent("beforeDestroy"),this.clear()},reset:function(){},select:function(a){this.unselect(),this.thumbnails&&(this.currentSelectedThumbnail=this.thumbnails.eq(a).addClass(this.options.selectedThumbnailClass))},template:"<a class='${$item.options.thumbnailClass}' href='${link || url}'{{if $item.options.renderThumbnailsTitle}} title='title'{{/if}} data-yoxthumbIndex='${$item.getIndex()}'><img src='${thumbnail.src}' alt='${title}' /></a>",unselect:function(){this.currentSelectedThumbnail&&(this.currentSelectedThumbnail.removeClass(this.options.selectedThumbnailClass),this.currentSelectedThumbnail=null)}},window.yox.thumbnails=yox.thumbnails}(jQuery),yox.controller=function(a,b){this.options=$.extend({},yox.controller.defaults,b);var c=this.options.eventsHandler||new yox.eventsHandler;$.extend(this,c);if(this.options.events)for(var d in this.options.events)this.addEventListener(d,this.options.events[d]);if(this.options.enableKeydown){this.enableKeyboard();if(this.options.keydownFrequency>0){var e=this;$(document).on("keyup.yoxController",function(){e.keydownLock=!1,clearTimeout(e.keydownLockTimeoutId)})}}},yox.controller.keys={40:"down",35:"end",13:"enter",36:"home",37:"left",39:"right",32:"space",38:"up",27:"escape"},yox.controller.prototype={destroy:function(){this.disableKeyboard()},disableKeyboard:function(){$(document).on("keydown.yoxController",this.onKeyDown)},enableKeyboard:function(){$(document).on("keydown.yoxController",{controller:this},this.onKeyDown)},onKeyDown:function(a){var b=yox.controller.keys[a.keyCode],c=a.data.controller;return b&&(a.preventDefault(),c.keydownLock||(c.triggerEvent("keydown",{key:b,keyCode:a.keyCode}),c.options.keydownFrequency>0&&(c.keydownLock=!0,c.keydownLockTimeoutId=setTimeout(function(){c.keydownLock=!1},c.options.keydownFrequency)))),!0}},yox.controller.defaults={enableKeydown:!0,keydownFrequency:0},function(a){yox.utils.css.addJqueryCssHooks(["transition","transitionDuration","transform","transformOrigin","transformStyle","backfaceVisibility","perspective"]),yox.view=function(b,c,d){var e=a.extend({},c.events),f=yox.view.config,g=yox.view.config.platform[yox.utils.browser.getPlatform()];d=d||yox.view.cache,delete c.events;var h=a.extend(!0,{},f.mode[c.resizeMode||g.resizeMode||f.defaults.resizeMode],f.defaults,g,c);for(var i in e){var j=h.events[i],k=e[i];j?j instanceof Array||(j=h.events[i]=[j]):j=h.events[i]=[],k instanceof Array?j=j.concat(k):typeof k=="function"&&j.push(k)}this.container=b,this.$container=a(b),this.options=h,this.id=yox.view.id?++yox.view.id:1,this.cache=d,this.direction=1;for(var l in this){var m=this[l];typeof m=="function"&&(this[l]=m.bind(this))}this.init()},yox.view.prototype=function(){function b(a){var b=typeof a=="string"?yox.view.transitions[a]:a;if(!b)throw new Error('Invalid transition - "'+a+"\" doesn't exist.");var c=new b;if(c instanceof yox.view.transition)c.create.call(this,this.$container),this.transition=c;else throw new Error("Invalid transition - transition constructors must have yox.view.transition as prototype.")}function c(c){var d={};c.$container.css("position")==="static"&&c.$container.css("position","relative"),a.extend(c,{getPosition:yox.utils.dimensions.resize[c.options.resizeMode],elements:d}),b.call(c,c.options.transition)}function d(){var b=a("<div>",{"class":"yoxview_info"});return b}function g(a,b){var c=a.data(b);if(!c){c=f[b].create.call(this),c?a.append(c):c=a[0],a.data(b,c),c!==a[0]&&(c.style.height=c.style.width="100%",c.style.display="none");if(this.options.displayInfo){var e=d();a.append(e).data("info",e)}}return c}function h(a){var b=[],c=this,d=c.items.length;for(var e=0;e<a.length;e++){var f=a[e];c.items=c.items.concat(f.items),b=b.concat(f.items)}c.triggerEvent("load",{items:b,sources:a}),c.initialized||(c.initialized=!0,c.triggerEvent("init"))}function i(a,b){if(a!==this.currentItem)return!1;if(a){var c=f[a.type],d=c.checkLoading?this.transition.getCurrentPanel():this.transition.getPanel(),e=d.data("itemType"),h=g.call(this,d,a.type);e!==a.type&&(e&&(e&&c.clear.call(this,h),d.data(e).style.display="none"),d.data("itemType",a.type)),c.checkLoading&&!h.loading&&(!this.options.showThumbnailsBeforeLoad||b)&&(d=this.transition.getPanel(a),h=g.call(this,d,a.type));if(this.options.displayInfo){var i=d.data("info");a.title?i.text(a.title).removeAttr("disabled"):i.text("").attr("disabled","disabled")}h.style.display="block",c.set.call(this,a,h,b)}else{var j=this.transition.getPanel();this.options.showThumbnailsBeforeLoad&&(c=f[this.previousItem.type],c.set.call(this,this.previousItem,j,!0)),this.transition.transition.call(this,{item:null}),this.triggerEvent("select")}}var e={resizeMode:function(a){this.getPosition=yox.utils.dimensions.resize[a]},transition:function(a){this.transition.destroy.call(this),b.call(this,a);var c=this.currentItem.id-1;this.currentItem=null,this.selectItem(c)}},f={html:{clear:function(a){a.innerHTML=""},create:function(){var a=document.createElement("div");return a.style.overflow="hidden",a},set:function(a,b){b.loading=!1,a.element?(b.innerHTML="",b.appendChild(a.element)):b.innerHTML=a.html,a.width||(a.width=this.containerDimensions.width),a.height||(a.height=this.containerDimensions.height),a.ratio=a.height/a.width;var c=this.getPosition(a,this.containerDimensions,this.options);this.transition.transition.call(this,{position:c,index:a.id-1,item:a}),this.triggerEvent("select",a)}},image:function(){function b(a){var b=a instanceof yox.view?a:a.data.view;this.loading=!1;if(b.currentItem&&b.currentItem.url!==this.src&&b.currentItem.thumbnail.src!==this.src)return!1;if(b.currentItem&&(!b.options.showThumbnailsBeforeLoad||this.loadingThumbnail)){this.loadingThumbnail=!1;var c=b.currentItem,d=b.getPosition(c,b.containerDimensions,b.options);b.transition.transition.call(b,{position:d,index:c.id-1,item:c})}}var c;return{checkLoading:!0,clear:function(a){a.src=""},create:function(){var c=document.createElement("img");return c.src="",a(c).on("load",{view:this},b),c},set:function(a,d,e){this.options.showThumbnailsBeforeLoad&&clearTimeout(c);var f=e&&a.thumbnail?a.thumbnail.src:a.url;d.loading=!0,e&&(d.loadingThumbnail=!0);if(d.src!==f){function g(){d.src="",d.src=f}this.options.showThumbnailsBeforeLoad&&!e?(clearTimeout(c),c=setTimeout(g,this.options.transitionTime+50)):g()}else b.call(d,this)}}}()};return{addDataSources:function(a){function d(a){h.call(b,a)}var b=this,c=a.getData();c&&c.length&&h.call(b,c),a.addEventListener("loadSources",d),this.addEventListener("beforeDestroy",function(){a.removeEventListener("loadSources",d)}),a.addEventListener("clear",function(){b.removeItems()})},cacheCount:0,close:function(){this.isOpen()&&(this.selectItem(null),this.triggerEvent("close"))},destroy:function(){this.triggerEvent("beforeDestroy"),this.transition.destroy()},first:function(){if(!this.currentItem)return!1;this.selectItem(0)},items:[],init:function(){var b=this;this.options.margin=yox.utils.dimensions.distributeMeasures(this.options.margin),this.options.padding=yox.utils.dimensions.distributeMeasures(this.options.padding);var d=this.options.eventsHandler||new yox.eventsHandler;a.extend(this,d);for(var e in this.options.events){var f=this.options.events[e];if(f instanceof Array)for(var g=0;g<f.length;g++)b.addEventListener(e,f[g]);else b.addEventListener(e,f)}c(this),this.options.data&&this.addDataSources(this.options.data);if(this.options.controls)for(var h in this.options.controls){var i=this[h];i&&a(this.options.controls[h]).data("yoxviewControl",h).on("click",function(c){c.preventDefault(),b[a(this).data("yoxviewControl")].call(b)})}this.update(),this.triggerEvent("create")},isOpen:function(){return!!this.currentItem},last:function(){if(!this.currentItem)return!1;this.selectItem(this.items.length-1)},next:function(a){if(!this.currentItem)return!1;this.direction=1;var b=this.currentItem.id;if(this.currentItem.id===this.items.length)if(this.options.loop)this.currentItem.id=0;else return!1;this.selectItem(b,undefined,a)},option:function(b,c){var d;c===undefined&&Object(b)===b?d=b:(d={},d[b]=c);for(var f in d){var g=this.options[f],h=d[f];if(g!==h){var i=e[f];i&&i.call(this,h,g)}}this.transition.update&&this.transition.update.call(this,d),a.extend(!0,this.options,d)},toggleSlideshow:function(){var a=this;this.isPlaying?(clearTimeout(this.playTimeoutId),this.isPlaying=!1,this.triggerEvent("slideshowStop")):(this.isPlaying=!0,this.playTimeoutId=setTimeout(function(){a.next.call(a,!0)},this.options.slideshowDelay),this.triggerEvent("slideshowStart"))},prev:function(){if(!this.currentItem)return!1;this.direction=-1;var a=this.currentItem.id-2;if(this.currentItem.id===1)if(this.options.loop)this.currentItem.id=this.items.length-1;else return!1;this.selectItem(a)},removeItems:function(){this.triggerEvent("removeItems",this.items),this.currentItem=undefined,this.items=[]},removeEventListener:function(b,c){if(c&&typeof c!="function")throw new Error("Invalid event handler, must be a function or undefined.");a(this.container).off(b+".modules",c)},selectItem:function(b,c,d){!d&&this.isPlaying?this.toggleSlideshow():d&&!this.isPlaying&&(this.isPlaying=!0,this.triggerEvent("slideshowStart"));if(!isNaN(b)){if(b>=this.items.length||b<0)throw new Error("Invalid item index: "+b);b=this.items[b]}if(String(b)===b){for(var e=0,f;f=this.items[e];e++)if(f.name&&f.name===b){b=f;break}f=null}else{b instanceof HTMLElement&&(b=a(b));if(b instanceof jQuery){var g=b.data("yoxviewIndex");isNaN(g)&&(g=parseInt(b.attr("data-yoxviewIndex"),10)),b=this.items[g]}}var h=this.currentItem,j=this;return h&&b&&b.id===h.id?!1:(this.triggerEvent("beforeSelect",{newItem:b,oldItem:h,data:c}),this.previousItem=this.currentItem,this.currentItem=b,b?(j.options.showThumbnailsBeforeLoad&&i.call(j,b,!0),this.cache.withItem(b,this,function(a){i.call(j,a)})):i.call(j,b),!0)},unload:function(){},update:function(a){this.options.transitionTime&&this.updateTransitionTimeoutId&&(clearTimeout(this.updateTransitionTimeoutId),this.updateTransitionTimeoutId=null);var b={width:this.$container.width(),height:this.$container.height()};if(a||!this.containerDimensions||b.width!==this.containerDimensions.width||b.height!==this.containerDimensions.height)this.containerDimensions=b,this.currentItem&&this.transition.transition.call(this,{position:this.getPosition(this.currentItem,this.containerDimensions,this.options),duration:0,isUpdate:!0})}}}(),yox.view.config={defaults:{cacheImagesInBackground:!0,createInfo:undefined,enlarge:!1,events:{init:function(){this.options.cacheImagesInBackground&&this.items.length&&yox.view.cache.cacheItem(this),this.removeEventListener("init")},select:function(a){var b=this;this.isPlaying&&(this.playTimeoutId=setTimeout(function(){b.next.call(b,!0)},Number(this.options.slideshowDelay)+Number(this.options.transitionTime||0)))}},container:document.body||document.getElementsByTagName("body")[0],loop:!0,panelDimensions:{width:1600,height:1600},resizeMode:"fit",showThumbnailsBeforeLoad:!1,slideshowDelay:3e3},mode:{fill:{transition:"fade",enlarge:!0,margin:0,padding:0},fit:{transition:"morph"}},platform:{mobile:{cacheBuffer:2,margin:0,padding:0,showInfo:!0,transitionTime:0},desktop:{cacheBuffer:5,margin:20,padding:0,showInfo:!0,transitionTime:300}},keys:{right:"next",left:"prev",enter:"toggleSlideshow",escape:"close",home:"first",end:"last",space:"next"}}}(jQuery),yox.view.cache=function(){function m(a,c){var d=!0;b++,c&&++a.cacheCount===a.items.length&&(delete a.cacheCount,a.isLoaded=!0,d=!1),d&&(d=b+g<a.options.cacheBuffer),d&&p(a)}function n(a,b){b.triggerEvent("cacheEnd",a),j=null}function o(a){if(!this.width||!this.height)return!1;var b=d[e=a.data.cacheImageIndex],c=b.item,f=b.view;c.width=this.width,c.height=this.height,c.ratio=this.height/this.width,c.isLoaded=!0,c.id===j&&n(c,f),f.triggerEvent("loadItem",c),b.onCache&&(b.onCache.call(f,c),b.onCache=null),g--,delete b.item,m(f,!0)}function p(b){var c=b.items.length,d=a+b.direction;d===c?d=0:d===-1&&(d+=c),q(b,b.items[d],null,f)}function q(h,i,j){if(h instanceof yox.view){if(!h)throw new Error("View is required for cacheItem.");if(arguments.length<4||arguments[3]!==f)b=0;i=i||h.items[0];if(i.type!=="image")return j&&j.call(h,i),!0;for(var k=0;k<c;k++){var l=d[k];if(l.view&&l.view.id===h.id&&l.item&&l.item.id===i.id&&j)return l.onCache=j,!0}a=i.id-1;if(!i.isLoaded&&i.type==="image"){var l=d[e];l.item=i,l.view=h,$.browser.mozilla&&(l.img.src=""),j&&(l.onCache=j),l.img.src=i.url,g++,++e===d.length&&(e=0),g<c&&b+g<h.options.cacheBuffer&&p(h)}else m(h,!i.isLoaded),i.isLoaded=!0,j&&j.call(h,i);return!0}throw new TypeError("Invalid view for cacheItem.")}function r(c,d,e){if(arguments.length<3||arguments[2]!==f)b=0;c.isLoaded?(e.call(d,c),j&&n(c,d),a=c.id-1,d.isLoaded||m(d,!1)):(i&&clearTimeout(i),i=setTimeout(function(){c.isLoaded||(i=null,d.triggerEvent("cacheStart",c),j=c.id)},h),q(d,c,e,f))}var a,b=0,c=2,d=[],e=0,f=(new Date).valueOf(),g=0,h=200,i,j;for(var k=0;k<c;k++){var l=new Image;l.setAttribute("data-id",k),$(l).on("load",{cacheImageIndex:k},o).on("error",function(a){console.error("Image not found or couldn't load:",this.src)}),d.push({img:l})}return{cacheItem:q,withItem:r}}(),yox.view.transition=function(a){this.name=a},yox.view.transitions={},yox.view.transition.prototype={create:function(a,b){throw new Error("'create' method isn't implemented for this transition type.")},destroy:function(){throw new Error("'destroy' method isn't implemented for this transition type.")},getCurrentPanel:function(){throw new Error("'getCurrentPanel' method isn't implemented for this transition type.")},getPanel:function(){throw new Error("'getPanel' method isn't implemented for this transition type.")},transition:function(a){throw new Error("'transition' method isn't implemented for this transition type.")},update:function(a){}},yox.view.transitions.thumbnails=function(){function j(a){return function(){a.css("visibility","visible")}}function k(d){clearTimeout(m),clearTimeout(n);var h=a[b],k=a[b?0:1];if(!d.isUpdate){if(d.item){var l;d.item.openFromElement?(l=$(d.item.openFromElement),delete d.item.openFromElement):l=$(d.item.thumbnail.image);var p=l.offset(),q=l.width()/d.position.width;window.getComputedStyle(l[0],null).position!=="fixed"&&window.getComputedStyle(l[0].parentNode,null).position!=="fixed"&&(p.top-=g.scrollTop,p.left-=g.scrollLeft),h.show().css($.extend({transition:"none",transform:["scale(",q,") translateX(",Math.round((p.left-d.position.left-d.position.width*(1-q)/2)/q),"px) translateY(",Math.round((p.top-d.position.top-d.position.height*(1-q)/2)/q),"px) translateZ(0)"].join(""),"z-index":f+1},d.position)),m=setTimeout(function(){h.css({transform:"scale(1) translateX(0) translateY(0) translateZ(0)",transition:"all "+c+"ms ease-out"})},5)}if(k&&e){var r=e.offset(),s=e.width()/i.width;r.top-=g.scrollTop,r.left-=g.scrollLeft,k.css({"z-index":f,transform:["scale(",s,") translateX(",Math.round((r.left-i.left-i.width*(1-s)/2)/s),"px) translateY(",Math.round((r.top-i.top-i.height*(1-s)/2)/s),"px) translateZ(0)"].join("")}),n=setTimeout(function(){k.hide()},c),o=setTimeout(j(e),c)}i=d.position,e=l,e&&e.css("visibility","hidden")}else h.css(d.position)}var a,b=1,c,d,e,f=100,g,h,i;this.create=function(b){function f(a){var d=$("<div>",{"class":"yoxviewFrame yoxviewFrame_"+e.options.resizeMode+" yoxviewFrame_"+yox.utils.browser.getPlatform()+" yoxviewFrame_thumbnails",css:{transition:"all "+c+"ms linear",transformOrigin:"center center",display:"none","box-sizing":"border-box",position:"fixed",overflow:"visible"}}).appendTo(b);$.browser.webkit&&d[0].style.setProperty("-webkit-transform","translateZ(0)");var f=document.createElement("a");return f.className="yoxview_close",f.onclick=e.close,d.append(f),b.append(d),d}function j(a){var b=window.getComputedStyle(a,null).overflow;return~["scroll","auto"].indexOf(b)}var e=this;d=c=this.options.transitionTime,a=[];for(var i=0;i<2;i++)a.push(f(i));g=b[0];while(!j(g)&&g.parentNode&&g!==document.documentElement)g=g.parentNode;h=g;if(g===document.body||g===document.documentElement)h=window},this.destroy=function(){for(var b=0;b<a.length;b++)a[b].remove();a=[]},this.getCurrentPanel=function(){return a[b]},this.getPanel=function(c){return b=b?0:1,a[b]};var l=yox.utils.performance.throttle(k,120),m,n,o;this.transition=function(a){a.isUpdate?l.call(this,a):k.call(this,a)},this.update=function(a){}},yox.view.transitions.thumbnails.prototype=new yox.view.transition("thumbnails"),yox.theme=function(a,b){},yox.themes={},yox.theme.prototype={create:function(a){throw new Error("'create' method is not implemented for this theme.")},destroy:function(){throw new Error("'destroy' method is not implemented for this theme.")},getThemeClass:function(a){return"yox-theme-"+this.name+(a?"-"+a:"")},init:function(a,b,c,d){function e(a,d,e){return e.data=b,e.eventsHandler={addEventListener:function(a,b){c.addEventListener(a,b.bind(this))},triggerEvent:function(a,b,e){c.triggerEvent.call(this,a+"."+d,b,e||this)}},new i(a,e)}if(!(b instanceof yox.data))throw new Error("Invalid data provided for theme, must be an instance of yox.data.");$.extend(this,c),this.create(a);var f=$.extend(!0,{},this.config,d.modules);for(var g in f){var h=f[g],i=yox[g];if(!i)throw new Error("Module not found: '"+g+"', can't create theme '"+this.name+"'.");var j=$(".yox"+g,a);if(h instanceof Array){this.modules[g]=[];for(var k=0,d;d=h[k];k++)this.modules[g].push(e(j[k],g,d))}else this.modules[g]=e(j[0],g,h)}},config:{},modules:{}},yox.themes.switcher=function(a,b){function j(a,b,c){c?(b.src=c.thumbnail.src,a.style.marginTop=Math.floor(f*c.ratio/-2)+"px",a.hasItem||(a.style.display="block"),a.hasItem=!0):(a.hasItem&&(a.style.display="none"),a.hasItem=!1)}function k(){d.modules.view.update()}var c,d=this,e=!1,f=70,g,h,i=yox.utils.performance.throttle(function(a){j(c.buttons.prev,c.buttons.prevImg,a.previous),j(c.buttons.next,c.buttons.nextImg,a.next)},0);this.name="switcher",this.config={view:{displayInfo:!0,enableKeyboard:!0,enlarge:!1,loop:!1,resizeMode:"fit",transition:yox.view.transitions.thumbnails,transitionTime:400,margin:{top:45,right:40,left:40,bottom:30},showThumbnailsBeforeLoad:!0,events:{"click.thumbnails":function(a,b){e&&a.isSelected?(this.close(),b.unselect()):this.selectItem(a.index)},beforeSelect:function(a){a.newItem&&(e||(clearTimeout(h),h=setTimeout(function(){$(c.container).addClass(d.getThemeClass("open")),c.buttons.wrapper.classList.add(d.getThemeClass("nav-enabled"))},d.config.view.transitionTime+100),e=!0),i(a.newItem))},close:function(a){clearTimeout(h),h=setTimeout(function(){c.buttons.wrapper.classList.remove(d.getThemeClass("nav-enabled")),$(c.container).removeClass(d.getThemeClass("open"))},d.config.view.transitionTime+100),d.modules.view.close(),e=!1},keydown:function(a){var b=yox.view.config.keys[a.key];b&&this[b]()}}},controller:{keydownFrequency:b.keydownFrequency}},a.addEventListener("clear",function(){d.modules.view.close()}),this.create=function(a){c={view:document.createElement("div"),container:a,buttons:{wrapper:document.createElement("div"),prev:document.createElement("a"),prevImg:document.createElement("img"),next:document.createElement("a"),nextImg:document.createElement("img")}},c.view.className=this.getThemeClass("view")+" yoxview",c.buttons.wrapper.className=this.getThemeClass("nav"),c.buttons.prev.className=this.getThemeClass("btn")+" "+this.getThemeClass("btn-prev"),c.buttons.prev.appendChild(c.buttons.prevImg),c.buttons.next.className=this.getThemeClass("btn")+" "+this.getThemeClass("btn-next"),c.buttons.next.appendChild(c.buttons.nextImg),c.buttons.prev.onclick=function(){g=c.buttons.prevImg,d.modules.view.prev()},c.buttons.next.onclick=function(){g=c.buttons.nextImg,d.modules.view.next()},a.appendChild(c.view),c.buttons.wrapper.appendChild(c.buttons.prev),c.buttons.wrapper.appendChild(c.buttons.next),a.appendChild(c.buttons.wrapper),$(window).on("resize",k),$(c.view).on("click","img",function(){d.modules.view.next()})},this.destroy=function(){c.container.removeChild(c.view),c.container.removeChild(c.buttons.prev),c.container.removeChild(c.buttons.next),$(window).off("resize",k),$(c.container).removeClass(d.getThemeClass("open")),c=null}},yox.themes.switcher.defaults={keydownFrequency:200,scrollDuration:500},yox.themes.switcher.prototype=new yox.theme,yox.themes.wall=function(a,b){function p(a,c,e,f){n+=a.dimensions.width,m.push(a);var g=c===e-1,h=(m.length-1)*b.borderWidth,i=n+h>=d;console.log("is last: ",g);if(i||g){var j=(d-h)/n,k=Math.round(m[0].dimensions.height*j),l=!0,o=i||g,p=h;k>b.thumbnailsMaxHeight&&(k=b.thumbnailsMaxHeight,l=!1);for(var q=0,r;r=m[q];q++){var s=Math.floor(r.dimensions.width*j);p+=s,r.style.height=k+"px",l?r.style.width=s+"px":g&&(r.style.width=r.dimensions.width+"px"),o&&r.style.removeProperty("display")}for(var t=m.length;t--&&p<d;p++)r=m[t],r.style.width=parseInt(r.style.width,10)+1+"px";if(!g||i)a.style.marginRight="0",m=[],n=0}else f&&a.style.removeProperty("margin-right")}function q(){var a=e.modules.thumbnails.thumbnails;if(!a)return;var b=a.length;for(var c=0,d;d=a[c];c++)p(d,c,b,!0)}function t(){if(!r)return!1;r.offset=a.countItems()+1,a.addSources([r])}function u(b){if(b.length){var c=b[0];r||(r=c.source,s=c.totalItems,r.type=c.sourceType),a.countItems()>=s&&e.triggerEvent("loadedAllItems")}f=!1,$(e.container).removeClass(l)}function v(a){i<k?(i++,this.style.visibility="visible",this.style.setProperty(yox.utils.browser.getCssPrefix()+"transform","scale(1)"),this.removeEventListener("load",v,!1),setTimeout(function(){i--,h.length&&v.call(h.shift())},j)):h.push(this)}function w(){f=!0,$(e.container).addClass(l),t()}function x(){!f&&c.scrollElementForMeasure.scrollTop>=c.scrollElementForMeasure.scrollHeight-c.scrollElementForMeasure.clientHeight-b.thumbnailsMaxHeight&&w()}var c={},d,e=this,f,g=!1,h=[],i=0,j=100,k=3;this.name="wall";var l=this.getThemeClass("loading"),m=[],n=0,o=yox.utils.performance.throttle(function(a){yox.utils.dom.scrollIntoView(a,e.container,b.scrollAnimationDuration,b.scrollOffset)},300);this.config={thumbnails:{createThumbnail:function(a,c,d){var e=document.createElement("a"),f=document.createElement("img"),g={height:b.thumbnailsMaxHeight,width:Math.round(b.thumbnailsMaxHeight/c.ratio)};return e.dimensions=g,f.addEventListener("load",v,!1),f.src=c.thumbnail.src,e.appendChild(f),e.setAttribute("href",c.url),e.style.display="none",p(e,a,d),e},events:{beforeSelect:function(a){b.scrollToElementOnSelect&&a.newItem&&o(a.newItem.thumbnail.element)},create:x}}};var r,s;u(a.getData()),a.addEventListener("loadSources",u),a.addEventListener("clear",function(){r=null,m=[],n=0,g&&(g=!1,c.scrollElement.addEventListener("scroll",x,!1),a.addEventListener("loadSources",u),$(e.container).removeClass(e.getThemeClass("loadedAll")))}),this.create=function(f){function i(){d=f.clientWidth-b.padding*2}this.container=f;var h=this.getThemeClass();$(f).addClass(h).addClass(l),c.wall=document.createElement("div"),c.wall.className=this.getThemeClass("thumbnails")+" yoxthumbnails",c.wall.style.padding=b.padding+"px",f.appendChild(c.wall),i();var j=document.createElement("style"),k=["margin-right: "+b.borderWidth+"px","margin-bottom: "+b.borderWidth+"px"];j.innerHTML=" ."+h+" a[data-yoxthumbindex]{ "+k.join("; ")+" }",document.getElementsByTagName("head")[0].appendChild(j),$(window).on("resize",yox.utils.performance.throttle(function(){$(f).addClass(e.getThemeClass("resizing")),i(),m=[],n=0,q(),setTimeout(function(){$(e.container).removeClass(e.getThemeClass("resizing"))},5)},50)),c.scrollElement=f===document.body?document:f,c.scrollElementForMeasure=f,!$.browser.webkit&&f===document.body&&(c.scrollElementForMeasure=document.documentElement),c.loader=document.createElement("div"),c.loader.className=this.getThemeClass("loader"),c.loader.style.paddingBottom=b.borderWidth+b.padding+"px",f.appendChild(c.loader),c.scrollElement.addEventListener("scroll",x,!1),e.addEventListener("loadedAllItems",function(){c.scrollElement.removeEventListener("scroll",x,!1),a.removeEventListener("loadSources",u),g=!0,$(f).addClass(e.getThemeClass("loadedAll"))})}},yox.themes.wall.defaults={borderWidth:7,loadItemsOnScroll:!1,padding:10,scrollAnimationDuration:500,scrollOffset:60,scrollToElementOnSelect:!1,thumbnailsMaxHeight:200},yox.themes.wall.prototype=new yox.theme;